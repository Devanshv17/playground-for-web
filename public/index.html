<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8"/>
    <title>Appwrite Playground</title>
    <meta name="description" content="A simple Appwrite demo app for gettig started with API integration"/>
    <meta name="author" content="Appwrite Team"/>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"/>
    <link href="https://fonts.googleapis.com/css?family=Poppins:100,300,400,500,600,800"/>
    <link rel="icon" type="image/png" href="https://appwrite.io/images/favicon.png?v=1"/>

    <style>
        body {
            font-family: Poppins, sans-serif, Arial;
            -webkit-font-smoothing: antialiased;
            font-weight: 500;
        }

        #list > li:hover {
            color: #007BFF;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-dark bg-dark">
        <a class="navbar-brand" href="#"><img src="https://appwrite.io/images/appwrite-white.svg" height="22"/>
            &nbsp;playground</a>
    </nav>
    <div class="jumbotron jumbotron-fluid">
        <div class="container">
            <h1 class="display-5 mb-5">Hello Appwriters!</h1>
            <p class="lead">
                Appwrite playground is a simple way to explore the Appwrite API & Web
                SDK. Use the
                <a href="https://github.com/appwrite/playground-for-js/blob/master/public/index.html"
                   target="_blank">source code</a>
                of this page to learn how to use the different Appwrite Web SDK
                features.
            </p>
        </div>
    </div>

    <div class="container">
        <h2 class="mb-5">Auth & Account</h2>

        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="isLogged()">
            Is Logged?
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="loginAnonymously()">
            Login Anonymously
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="loginWithGoogle()">
            Login With Google
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="loginWithFacebook()">
            Login With Facebook
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="loginWithGithub()">
            Login With Github
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="loginWithApple()">
            Login With Apple
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="createJWT()">
            Create JWT
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="getUserName()">
            Get User Name
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="getUserEmail()">
            Get User Email
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="listSessions()">
            Get User Sessions
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="listLogs()">
            Get User Logs
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="deleteSessions()">
            Delete All Sessions
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="deleteCurrentSession()">
            Delete Current Session
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="createTeam()">
            Create Team
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="createTeamMembership()">
            Create Team Membership
        </button>
    </div>

    <hr class="mb-5"/>

    <div class="container">
        <div class="row">
            <div class="col-sm mb-5">
                <h3 class="mb-4">Register</h3>
                <form onsubmit="register(event);">
                    <div class="form-group">
                        <label for="register-email">Email</label>
                        <input type="email" class="form-control" id="register-email" placeholder="Enter email"
                               value="demo@example.com" required/>
                    </div>
                    <div class="form-group">
                        <label for="register-password">Password</label>
                        <input type="password" class="form-control" id="register-password" placeholder="Password"
                               value="password" required pattern=".{6,}" title="Six or more characters"/>
                    </div>
                    <button type="submit" class="btn btn-primary">Sign Up</button>
                </form>
            </div>
            <div class="col-sm mb-5">
                <h3 class="mb-4">Login</h3>
                <form onsubmit="login(event);">
                    <div class="form-group">
                        <label for="login-email">Email</label>
                        <input type="email" class="form-control" id="login-email" placeholder="Enter email"
                               value="demo@example.com" required/>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" class="form-control" id="login-password" placeholder="Password"
                               value="password" required pattern=".{6,}" title="Six or more characters"/>
                    </div>
                    <button type="submit" class="btn btn-primary">Sign In</button>
                </form>
            </div>
        </div>
    </div>

    <hr class="mb-5"/>

    <div class="container">
        <h2 class="mb-5">Storage</h2>
        <div class="row">
            <div class="col-sm mb-5">
                <h3 class="mb-4">Add File</h3>
                <div class="input-group">
                    <div class="custom-file">
                        <input type="file" class="custom-file-input" id="uploader" aria-describedby="inputGroupFileAddon04">
                        <label class="custom-file-label" id="uploader-label" for="uploader">Choose file</label>
                    </div>
                    <div class="input-group-append">
                        <button class="btn btn-primary" type="button" id="inputGroupFileAddon04" onclick="createFile()">
                            Upload File
                        </button>
                    </div>
                </div>
            </div>
            <div class="col-sm mb-5">
                <h3 class="mb-4">List Files</h3>
                <button type="button" class="btn btn-primary" onclick="listFiles()">
                    List Files
                </button>
                <div class="container mt-3">
                    <div class="row">
                        <ul id="fileList"></ul>
                    </div>
                </div>
            </div>
            <div class="col-sm mb-5">
                <h3 class="mb-4">Get File</h3>
                <button type="button" class="btn btn-primary" onclick="getFile()">
                    Get File
                </button>
            </div>
            <div class="col-sm mb-5">
                <h3 class="mb-4">Delete File</h3>
                <button type="button" class="btn btn-primary" onclick="deleteFile()">
                    Delete File
                </button>
            </div>
        </div>
    </div>

    <hr class="mb-5"/>


    <hr class="mb-5"/>

    <hr class="mb-5"/>

    <div class="container">
        <h2 class="mb-5">Realtime</h2>
        <p>Create files in the Storage service to see them listed here in realtime.</p>
        <ul id="realtime" class="list-group"></ul>
    </div>

    <hr class="mb-5"/>

    <div class="container">
        <h2 class="mb-5">Locale</h2>

        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="getLocation()">
            Get User Location
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="getIP()">
            Get User IP
        </button>
        <button type="button" class="btn btn-primary btn-lg mr-4 mb-4" onclick="isEU()">
            Is User a Member of the EU?
        </button>
    </div>

    <!-- Include Appwrite Web SDK before trying to create a new instance -->

    <!-- Fetch the latest sdk or use an existing one -->
    <script src="https://cdn.jsdelivr.net/npm/appwrite@10.0.1"></script>

    <script>

        document.getElementById('uploader').onchange = function () {
            document.getElementById('uploader-label').innerHTML = this.files[0].name;
        };

        // Before we start doing anything, we need to init our Appwrite Web SDK
        const client = new Appwrite.Client();

        client
            .setEndpoint("https://demo.appwrite.io/v1") // Set your own appwrite server endpoint here, if not sure, you can get this value from your project settings page.
            .setProject("playground");                  // Your Appwrite Project UID, you can get it from your project settings page.

        // Prepare all services we are going to use
        const account = new Appwrite.Account(client);
        const storage = new Appwrite.Storage(client);
        const teams = new Appwrite.Teams(client);
        const locale = new Appwrite.Locale(client);
        const databases = new Appwrite.Databases(client);
        const functions = new Appwrite.Functions(client);

        // Declare ID's we will need
        let bucketId = 'test';
        let fileId;
        let userId;
        let teamId;
        let membershipId;

        /**
         * Please Note!
         *
         * Don't ever integrate your Appwrite SDK with a secret key on client apps
         * like browsers, Android apps, iOS apps and other client platforms
         * like electron, XBOX and others.
         */

        const realtimeElement = document.getElementById("realtime");

        client.subscribe("files", function (response) {
            const entry = document.createElement("li");
            const image = storage.getFilePreview(bucketId, response.payload.$id, 250);
            const url = storage.getFileView(bucketId, response.payload.$id);
            entry.classList.add('list-group-item');
            entry.innerHTML = `<a href="${url}" target=_blank><b>Events</b>: ${response.events}<br><img src="${image}" /></a>`;
            realtimeElement.prepend(entry);
        });

        client.subscribe(['teams', 'memberships', 'accounts'], function (response) {
            console.log(response)
        });

        function isLogged() {
            let promise = account.get();

            promise.then(
                function (response) {
                    alert("User is Logged!");
                    console.log(response);
                },
                function (error) {
                    alert("No User is Logged!");
                    console.log(error);
                }
            );
        }

        function getUserName() {
            let promise = account.get();

            promise.then(
                function (response) {
                    alert(response.name);
                    console.log(response);
                },
                function (error) {
                    alert("No User is Logged!");
                    console.log(error);
                }
            );
        }

        function getUserEmail() {
            let promise = account.get();

            promise.then(
                function (response) {
                    alert(response.email);
                    console.log(response);
                },
                function (error) {
                    alert("No User is Logged!");
                    console.log(error);
                }
            );
        }

        function listSessions() {
            let promise = account.listSessions();

            promise.then(
                function (response) {
                    alert(
                        "User has " +
                        response.total +
                        " active sessions. Check developer console for more info"
                    );
                    console.log(response);
                },
                function (error) {
                    alert("No User is Logged!");
                    console.log(error);
                }
            );
        }

        function listLogs() {
            let promise = account.listLogs();

            promise.then(
                function (response) {
                    alert(
                        "User has " +
                        response.logs.length +
                        " logs. Check developer console for more info"
                    );
                    console.log(response);
                },
                function (error) {
                    alert("No User is Logged!");
                    console.log(error);
                }
            );
        }

        function register(event) {
            const id = Appwrite.ID.unique();
            const email = event.target.elements["register-email"].value;
            const password = event.target.elements["register-password"].value;
            const name = "User Name";

            account.create(id, email, password, name).then(
                function (response) {
                    alert("Account created successfully!");
                    console.log(response);
                    userId = response.$id;
                },
                function (error) {
                    alert(error.message);
                    console.log(error);
                }
            );
        }

        function loginAnonymously() {
            account.createAnonymousSession().then(
                function (response) {
                    alert("anonymous session created successfully!");
                    console.log(response);
                    userId = response.$id;
                },
                function (error) {
                    alert("failed to create session");
                    console.log(error);
                }
            );
        }

        function createJWT() {
            account.createJWT().then(
                function (response) {
                    alert("JWT created successfully!");
                    console.log(response);
                },
                function (error) {
                    alert("failed to create session");
                    console.log(error);
                }
            );
        }

        function login(event) {
            account
                .createEmailSession(
                    event.target.elements["login-email"].value, // Email
                    event.target.elements["login-password"].value // Password
                )
                .then(
                    function (response) {
                        alert("Session created successfully!");
                        console.log(response);
                        client.subscribe("account", function (response) {
                            console.log('Received Account event', response);
                        });

                    },
                    function (error) {
                        alert("Failed to create session");
                        console.log(error);
                    }
                );
        }

        function loginWithGoogle(event) {
            /**
             * Callback URLs are required for creating a browser
             *  session cookie due to some browsers 3rd party cookie policy limitations,
             *  this is not required for other client based platforms
             */
            let promise = account.createOAuth2Session(
                "google",
                "http://localhost:8000/?success", // Callback URL for success
                "http://localhost:8000/?failure" // Callback URL for failure
            );

            promise.then(
                function (response) {
                    console.log(response); // Success
                },
                function (error) {
                    console.log(error); // Failure
                }
            );
        }

        function loginWithFacebook(event) {
            /**
             * Callback URLs are required for creating a browser
             *  session cookie due to some browsers 3rd party cookie policy limitations,
             *  this is not required for other client based platforms
             */
            let promise = account.createOAuth2Session(
                "facebook",
                "http://localhost:8000/?success", // Callback URL for success
                "http://localhost:8000/?failure", // Callback URL for failure
                ["user_location"]
            );

            promise.then(
                function (response) {
                    console.log(response); // Success
                },
                function (error) {
                    console.log(error); // Failure
                }
            );
        }

        function loginWithGithub(event) {
            /**
             * Callback URLs are required for creating a browser
             *  session cookie due to some browsers 3rd party cookie policy limitations,
             *  this is not required for other client based platforms
             */
            let promise = account.createOAuth2Session(
                "github",
                "http://localhost:8000/?success", // Callback URL for success
                "http://localhost:8000/?failure", // Callback URL for failure
                []
            );

            promise.then(
                function (response) {
                    console.log(response); // Success
                },
                function (error) {
                    console.log(error); // Failure
                }
            );
        }

        function loginWithApple(event) {
            /**
             * Callback URLs are required for creating a browser
             *  session cookie due to some browsers 3rd party cookie policy limitations,
             *  this is not required for other client based platforms
             */
            let promise = account.createOAuth2Session(
                "apple",
                "http://localhost:8000/?success", // Callback URL for success
                "http://localhost:8000/?failure" // Callback URL for failure
            );

            promise.then(
                function (response) {
                    console.log(response); // Success
                },
                function (error) {
                    console.log(error); // Failure
                }
            );
        }

        function deleteSessions() {
            let promise = account.deleteSessions();

            promise.then(
                function (response) {
                    alert("All sessions deleted."); // Success
                },
                function (error) {
                    alert("Failed to delete sessions."); // Failure
                    console.log(error); // Failure
                }
            );
        }

        function deleteCurrentSession() {
            let promise = account.deleteSession('current');

            promise.then(
                function (response) {
                    alert("Current session deleted."); // Success
                },
                function (error) {
                    alert("Failed to delete current session."); // Failure
                    console.log(error);
                }
            );
        }

        function createTeam() {
            let promise = teams.create(Appwrite.ID.unique(), 'Test Team');

            promise.then(
                function (response) {
                    alert("Team created."); // Success
                    console.log(response);
                    teamId = response.$id;
                },
                function (error) {
                    alert("Failed to create team."); // Failure
                    console.log(error);
                }
            );
        }

        function createTeamMembership() {
            let random = Math.floor(1000 + Math.random() * 9000);
            let email = "test+" + random + "@test.com";
            let promise = teams.createMembership(
                teamId,
                email,
                ['admin'],
                'http://localhost'
            );

            promise.then(
                function (response) {
                    alert("Membership created."); // Success
                    console.log(response);
                    membershipId = response.$id;
                },
                function (error) {
                    alert("Failed to create membership."); // Failure
                    console.log(error);
                }
            );
        }

                }
            );
        }

        function createFile() {
            let promise = storage.createFile(
                bucketId,
                Appwrite.ID.unique(),
                document.getElementById('uploader').files[0]
            );

            promise.then(function (response) {
                alert("File uploaded successfully");
                console.log(response);
                fileId = response.$id;
            }, function (error) {
                alert("Failed to upload file");
                console.log(error);
            });
        }

        function listFiles() {
            let promise = storage.listFiles(bucketId);

            promise.then(function (response) {
                const ul = document.getElementById("fileList");
                ul.innerHTML = '';
                for (let i = 1; i <= response.total; i++) {
                    const li = document.createElement("li");
                    li.innerHTML = response.files[i - 1].name;
                    console.log(response.files[i - 1].$id);
                    li.onclick = function () {
                        getFile(response.files[i - 1].$id);
                    };
                    ul.appendChild(li);
                }
                console.log(response); // Success
            }, function (error) {
                alert("Failed to list files.");
                console.log(error);
            });
        }

        function getFile() {
            let promise = storage.getFile(bucketId, fileId);

            promise.then(function (response) {
                alert("File fetched successfully");
                console.log(response); // Success
            }, function (error) {
                alert("Failed to get file.");
                console.log(error);
            });
        }

        function deleteFile() {
            let promise = storage.deleteFile(bucketId, fileId);

            promise.then(function (response) {
                alert("File deleted successfully");
                console.log(response); // Success
            }, function (error) {
                alert("Failed to delete file.");
                console.log(error);
            });
        }

        function getLocation() {
            let promise = locale.get();

            promise.then(
                function (response) {
                    alert(
                        "User is from " +
                        response.country +
                        ", country code is: " +
                        response.countryCode
                    );
                },
                function (error) {
                    alert("No User is Logged!");
                    console.log(error);
                }
            );
        }

        function getIP() {
            let promise = locale.get();

            promise.then(
                function (response) {
                    alert("User IP is: " + response.ip);
                },
                function (error) {
                    alert("Failed to get user locale.");
                    console.log(error);
                }
            );
        }

        function isEU() {
            let promise = locale.get();

            promise.then(
                function (response) {
                    alert(
                        response.eu
                            ? "User is a member of the EU"
                            : "User is not a member of the EU"
                    );
                },
                function (error) {
                    alert("Failed to get user locale.");
                    console.log(error);
                }
            );
        }
    </script>
</body>

</html>
